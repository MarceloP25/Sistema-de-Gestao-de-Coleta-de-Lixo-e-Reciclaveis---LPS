package com.mycompany.sistemadecoletadelixo.adminsystem.controller;

import com.mycompany.sistemadecoletadelixo.adminsystem.model.classes.Administrador;
import com.mycompany.sistemadecoletadelixo.adminsystem.view.FRCadAdmin;
import jakarta.persistence.EntityManager;
import jakarta.persistence.EntityManagerFactory;
import jakarta.persistence.Persistence;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

public class AdministradorController {
    private FRCadAdmin view;
    private EntityManagerFactory emf;
    private EntityManager em;

    public AdministradorController(FRCadAdmin view) {
        this.view = view;
        this.emf = Persistence.createEntityManagerFactory("SistemaDeColetaDeLixoPU");
        this.em = emf.createEntityManager();
        initController();
    }

    private void initController() {
        view.getBntCad().addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                cadastrarAdministrador();
            }
        });

        view.getBntVoltar().addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                voltar();
            }
        });
    }

    private void cadastrarAdministrador() {
        Administrador admin = new Administrador();
        admin.setNome(view.getEdtNome().getText());
        admin.setEmail(view.getEdtEmail().getText());
        admin.setSenha(view.getEdtSenha().getText());
        admin.setCpfCnpj(view.getEdtCPFCNPJ().getText());
        admin.setDataNasc(LocalDate.parse(view.getEdtDataNasc().getText()));
        admin.setEnderecoRua(view.getEdtEnderecoRua().getText());
        admin.setEnderecoBairro(view.getEdtEnderecoBairro().getText());
        admin.setEnderecoCidade(view.getEdtEnderecoCidade().getText());
        admin.setEnderecoNumero(view.getEdtEnderecoNumero().getText());
        admin.setEnderecoComplemento(view.getEdtEnderecoComplemento().getText());
        admin.setCep(view.getEdtCep().getText());

        em.getTransaction().begin();
        em.persist(admin);
        em.getTransaction().commit();
    }

    private void voltar() {
        view.dispose();
    }
}